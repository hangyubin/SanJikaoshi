# 智能考试系统 - 宝塔面板部署指南

## 一、系统概述

智能考试系统是一个基于Vue 3 + Spring Boot开发的在线考试平台，支持用户注册登录、考试管理、题目管理等功能。本指南将详细介绍如何在宝塔面板上部署该系统。

### 系统架构
- **前端**：Vue 3 + TypeScript + Element Plus
- **后端**：Spring Boot + Spring Security + JPA
- **数据库**：MySQL 5.7+
- **服务器**：Nginx（前端静态资源） + Java（后端服务）

## 二、环境准备

### 1. 服务器要求
- **操作系统**：CentOS 7/8、Ubuntu 18.04/20.04或Debian 10+
- **内存**：至少2GB（推荐4GB）
- **CPU**：至少1核（推荐2核）
- **磁盘**：至少20GB（推荐40GB）
- **网络**：稳定的网络连接
- **防火墙**：开放80、443、22、8080端口

### 2. 宝塔面板安装

#### （1）获取安装脚本
登录服务器，使用以下命令获取宝塔面板安装脚本：

- **CentOS系统**：
  ```bash
  yum install -y wget && wget -O install.sh http://download.bt.cn/install/install_6.0.sh && sh install.sh
  ```

- **Ubuntu/Debian系统**：
  ```bash
  wget -O install.sh http://download.bt.cn/install/install-ubuntu_6.0.sh && sudo bash install.sh
  ```

#### （2）安装过程
1. 执行安装命令后，系统会提示是否继续安装，输入`y`并按回车
2. 等待安装完成（约5-10分钟）
3. 安装完成后，系统会显示面板地址、用户名和密码，务必保存好这些信息

#### （3）初始登录
1. 在浏览器中输入面板地址
2. 使用初始用户名和密码登录
3. 首次登录时，系统会提示安装推荐软件，选择「跳过」（我们将手动安装所需软件）
4. 修改初始密码，设置一个强密码
5. 绑定宝塔账号（可选）

### 3. 安装必要软件

#### （1）进入软件商店
1. 登录宝塔面板
2. 点击左侧菜单「软件商店」
3. 切换到「运行环境」标签页

#### （2）安装Nginx
1. 找到「Nginx」软件，点击「安装」
2. 选择版本（推荐1.20+）
3. 选择「极速安装」
4. 等待安装完成

#### （3）安装MySQL
1. 找到「MySQL」软件，点击「安装」
2. 选择版本（推荐5.7+）
3. 选择「极速安装」
4. 等待安装完成
5. 安装完成后，点击「设置」
6. 进入「安全」标签页，修改root密码（务必设置强密码）
7. 点击「保存」

#### （4）安装Java
1. 找到「Tomcat」或「Java项目管理器」软件
2. 点击「安装」
3. 选择Java版本（推荐Java 8）
4. 选择「极速安装」
5. 等待安装完成

#### （5）安装Maven（可选）
如果需要在服务器上构建后端项目，需要安装Maven：
1. 找到「Maven」软件，点击「安装」
2. 选择版本（推荐3.6+）
3. 选择「极速安装」
4. 等待安装完成

### 4. 开放必要端口

1. 点击左侧菜单「安全」
2. 点击「添加规则」
3. 依次开放以下端口：
   - 80（HTTP）
   - 443（HTTPS）
   - 22（SSH）
   - 8080（后端服务）
4. 点击「确定」

## 三、后端部署

### 1. 构建后端项目

#### （1）本地构建（推荐）
在本地开发环境中构建后端jar包：

```bash
# 进入后端项目目录
cd D:\trae-ai\smart-exam-system\backend

# 清理并构建jar包（跳过测试）
mvn clean package -DskipTests
```

构建完成后，在 `target` 目录下会生成 `backend-0.0.1-SNAPSHOT.jar` 文件。

#### （2）服务器构建
如果无法在本地构建，也可以在服务器上进行构建：

```bash
# 登录服务器
ssh root@your-server-ip

# 进入后端项目目录
cd /www/wwwroot/smart-exam-backend

# 克隆或上传项目代码
# git clone <repository-url> 或使用宝塔面板文件上传功能

# 构建jar包
mvn clean package -DskipTests
```

### 2. 部署后端服务

#### （1）上传后端jar包
- 登录宝塔面板
- 进入左侧菜单「文件」
- 在 `/www/wwwroot` 目录下创建 `smart-exam-backend` 文件夹
- 上传构建好的 `backend-0.0.1-SNAPSHOT.jar` 文件到该文件夹

#### （2）配置后端环境

1. **修改数据库连接配置**
   - 在 `smart-exam-backend` 文件夹中创建 `application.properties` 文件
   - 添加以下内容（根据实际情况修改）：

   ```properties
   # 应用名称
   spring.application.name=smart-exam-backend

   # 数据源配置
   spring.datasource.url=jdbc:mysql://localhost:3306/smart_exam?useUnicode=true&characterEncoding=utf-8&useSSL=false&serverTimezone=Asia/Shanghai
   spring.datasource.username=smart_exam_user
   spring.datasource.password=your-database-password
   spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

   # JPA配置
   spring.jpa.hibernate.ddl-auto=update
   spring.jpa.show-sql=true
   spring.jpa.properties.hibernate.format_sql=true
   spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL57Dialect

   # 应用端口
   server.port=8080
   server.servlet.context-path=/api
   ```

2. **添加Java项目**
   - 进入左侧菜单「Java项目」
   - 点击「添加项目」
   - 填写项目信息：
     - **项目名称**：smart-exam-backend
     - **项目路径**：/www/wwwroot/smart-exam-backend
     - **运行jar包**：/www/wwwroot/smart-exam-backend/backend-0.0.1-SNAPSHOT.jar
     - **Java版本**：选择已安装的Java 8
     - **端口**：8080
     - **自动启动**：开启
   - 点击「提交」

3. **启动后端服务**
   - 在「Java项目」列表中找到 `smart-exam-backend` 项目
   - 点击「启动」
   - 等待服务启动完成，状态变为「运行中」

## 四、前端部署

### 1. 构建前端项目

#### （1）本地构建（推荐）
在本地开发环境中构建前端静态文件：

```bash
# 进入前端项目目录
cd D:\trae-ai\smart-exam-system\frontend

# 安装依赖
npm install

# 构建生产版本
npm run build
```

构建完成后，在 `dist` 目录下会生成静态文件。

#### （2）服务器构建
如果无法在本地构建，也可以在服务器上进行构建：

```bash
# 登录服务器
ssh root@your-server-ip

# 进入前端项目目录
cd /www/wwwroot/smart-exam-frontend

# 克隆或上传项目代码
# git clone <repository-url> 或使用宝塔面板文件上传功能

# 安装依赖
npm install

# 构建生产版本
npm run build
```

### 2. 部署前端静态资源

#### （1）上传前端文件
- 登录宝塔面板
- 进入左侧菜单「文件」
- 在 `/www/wwwroot` 目录下创建 `smart-exam-frontend` 文件夹
- 上传构建好的 `dist` 目录下的所有文件到该文件夹

#### （2）创建网站
- 进入左侧菜单「网站」
- 点击「添加站点」
- 填写网站信息：
  - **域名**：填写您的域名（如 `exam.example.com`），如果没有域名可以使用IP地址
  - **根目录**：/www/wwwroot/smart-exam-frontend
  - **PHP版本**：纯静态
- 点击「提交」

#### （3）配置反向代理
为了让前端能够访问后端API，需要配置反向代理：

1. 进入刚创建的网站详情页
2. 点击「反向代理」
3. 点击「添加反向代理」
4. 填写代理信息：
   - **代理名称**：api
   - **目标URL**：http://127.0.0.1:8080
   - **发送域名**：$host
   - **代理目录**：/api
   - **启用Websocket**：关闭
5. 点击「提交」

#### （4）配置SSL证书（可选）
如果您有域名，可以配置SSL证书，启用HTTPS访问：

1. 进入网站详情页
2. 点击「SSL」
3. 选择「Let's Encrypt」
4. 勾选需要申请证书的域名
5. 点击「申请」
6. 申请成功后，开启「强制HTTPS」

## 五、数据库配置

### 1. 创建数据库
- 进入左侧菜单「数据库」
- 点击「添加数据库」
- 填写数据库信息：
  - **数据库名**：smart_exam
  - **用户名**：smart_exam_user
  - **密码**：设置一个强密码
  - **字符集**：utf8mb4
  - **排序规则**：utf8mb4_general_ci
- 点击「提交」

### 2. 数据库初始化
系统会自动初始化数据库，包括：
- 创建所有必要的表
- 初始化管理员账号
- 初始化角色和权限
- 初始化基础数据

**管理员账号信息**：
- 用户名：admin
- 密码：admin123

## 六、系统启动与测试

### 1. 启动服务

1. **启动后端服务**：
   - 进入「Java项目」
   - 确保 `smart-exam-backend` 项目状态为「运行中」

2. **启动前端服务**：
   - 前端使用Nginx作为静态资源服务器，无需单独启动
   - 确保Nginx服务正常运行

### 2. 访问系统

使用浏览器访问您配置的域名或IP地址：
- HTTP：`http://your-domain-or-ip`
- HTTPS：`https://your-domain`（如果已配置SSL）

### 3. 测试系统功能

1. **登录系统**：
   - 使用管理员账号（admin/admin123）登录
   - 验证登录功能是否正常

2. **测试核心功能**：
   - 管理用户
   - 管理考试
   - 管理题目
   - 进行考试

## 七、常见问题及解决方案

### 1. 502 Bad Gateway

**问题**：访问系统时显示502错误

**解决方案**：
- 检查后端服务是否正常运行
- 检查反向代理配置是否正确
- 检查端口是否被占用：`netstat -tunlp | grep 8080`
- 检查Nginx日志：`/www/wwwlogs/your-domain-error.log`

### 2. 数据库连接失败

**问题**：后端服务无法连接到数据库

**解决方案**：
- 检查数据库服务是否正常运行：`systemctl status mysqld`
- 检查数据库连接配置是否正确
- 检查数据库用户权限：`GRANT ALL PRIVILEGES ON smart_exam.* TO 'smart_exam_user'@'localhost' IDENTIFIED BY 'your-password' WITH GRANT OPTION; FLUSH PRIVILEGES;`
- 检查数据库是否存在：`CREATE DATABASE IF NOT EXISTS smart_exam DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;`

### 3. 管理员账号登录失败

**问题**：使用admin/admin123登录失败

**解决方案**：
- 检查后端服务是否正常运行
- 检查数据库中是否已初始化管理员账号：
  ```sql
  SELECT * FROM user WHERE username = 'admin';
  ```
- 手动创建管理员账号：
  ```sql
  INSERT INTO user (username, password, real_name, email, phone, status, create_time, update_time) VALUES ('admin', '$2a$10$...', '系统管理员', 'admin@example.com', '13800138000', 1, UNIX_TIMESTAMP()*1000, UNIX_TIMESTAMP()*1000);
  ```
  （注意：密码需要使用BCrypt加密，您可以使用在线BCrypt加密工具生成）

### 4. 前端无法访问后端API

**问题**：前端请求后端API时出现跨域错误或404错误

**解决方案**：
- 检查反向代理配置是否正确
- 检查后端服务是否正常运行
- 检查前端请求路径是否正确
- 检查CORS配置是否正确

## 八、注意事项

1. **定期备份数据**：
   - 进入「数据库」-「备份」
   - 设置自动备份，建议每天备份一次
   - 定期下载备份文件到本地

2. **优化服务器性能**：
   - 配置Nginx缓存，提高静态资源访问速度
   - 调整Java虚拟机参数，优化后端性能
   - 配置MySQL参数，优化数据库性能

3. **加强服务器安全**：
   - 配置防火墙，只开放必要的端口（80、443、22等）
   - 定期更新服务器系统和软件
   - 使用强密码，并定期更换
   - 禁用不必要的服务和端口

4. **监控系统运行状态**：
   - 使用宝塔面板的「监控」功能，实时监控服务器CPU、内存、磁盘、网络等状态
   - 配置告警通知，及时发现并处理问题

5. **日志管理**：
   - 定期查看系统日志，及时发现并解决问题
   - 配置日志轮转，避免日志文件过大

## 九、相关文件路径

| 项目 | 路径 | 用途 |
|------|------|------|
| 后端项目 | /www/wwwroot/smart-exam-backend | 后端应用代码和jar包 |
| 前端项目 | /www/wwwroot/smart-exam-frontend | 前端静态资源 |
| Nginx配置 | /www/server/nginx/conf/nginx.conf | Nginx主配置文件 |
| 网站配置 | /www/server/nginx/conf/vhost/your-domain.conf | 网站Nginx配置文件 |
| 后端日志 | /www/wwwroot/smart-exam-backend/logs | 后端应用日志 |
| 访问日志 | /www/wwwlogs/your-domain-access.log | 网站访问日志 |
| 错误日志 | /www/wwwlogs/your-domain-error.log | 网站错误日志 |

## 十、联系方式

如果您在部署过程中遇到问题，可以通过以下方式获取帮助：

- 查看项目文档
- 联系技术支持
- 提交Issue到项目仓库

---

**文档更新时间**：2025-12-07
**文档版本**：1.0
**适用系统版本**：智能考试系统 v1.0
